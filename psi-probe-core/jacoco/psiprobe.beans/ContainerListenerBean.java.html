<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ContainerListenerBean.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">psi-probe-core</a> &gt; <a href="index.source.html" class="el_package">psiprobe.beans</a> &gt; <span class="el_source">ContainerListenerBean.java</span></div><h1>ContainerListenerBean.java</h1><pre class="source lang-java linenums">/**
 * Licensed under the GPL License. You may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   https://www.gnu.org/licenses/old-licenses/gpl-2.0.html
 *
 * THIS PACKAGE IS PROVIDED &quot;AS IS&quot; AND WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
 * WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE.
 */
package psiprobe.beans;

import com.maxmind.db.CHMCache;
import com.maxmind.geoip2.DatabaseReader;
import com.maxmind.geoip2.exception.AddressNotFoundException;
import com.maxmind.geoip2.model.CountryResponse;
import com.maxmind.geoip2.record.Country;

import java.io.File;
import java.net.InetAddress;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashSet;
import java.util.List;
import java.util.Locale;
import java.util.Set;

import javax.inject.Inject;
import javax.management.InstanceNotFoundException;
import javax.management.MBeanServer;
import javax.management.MBeanServerNotification;
import javax.management.Notification;
import javax.management.NotificationListener;
import javax.management.ObjectInstance;
import javax.management.ObjectName;
import javax.management.RuntimeOperationsException;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import psiprobe.model.Connector;
import psiprobe.model.RequestProcessor;
import psiprobe.model.ThreadPool;
import psiprobe.model.jmx.ThreadPoolObjectName;
import psiprobe.tools.JmxTools;

/**
 * This class interfaces Tomcat JMX functionality to read connection status. The class essentially
 * provides and maintains the list of connection ThreadPools.
 */
<span class="fc" id="L51">public class ContainerListenerBean implements NotificationListener {</span>

  /** The Constant logger. */
<span class="fc" id="L54">  private static final Logger logger = LoggerFactory.getLogger(ContainerListenerBean.class);</span>

  /** The allowed operation. */
<span class="fc" id="L57">  private Set&lt;String&gt; allowedOperation =</span>
<span class="fc" id="L58">      new HashSet&lt;&gt;(Arrays.asList(&quot;start&quot;, &quot;stop&quot;, &quot;pause&quot;, &quot;resume&quot;));</span>

  /** The pool names. */
  private List&lt;ThreadPoolObjectName&gt; poolNames;

  /** The executor names. */
  private List&lt;ObjectName&gt; executorNames;

  /** Used to obtain required {@link MBeanServer} instance. */
  @Inject
  private ContainerWrapperBean containerWrapper;

  /**
   * Gets the container wrapper.
   *
   * @return the container wrapper
   */
  public ContainerWrapperBean getContainerWrapper() {
<span class="fc" id="L76">    return containerWrapper;</span>
  }

  /**
   * Sets the container wrapper.
   *
   * @param containerWrapper the new container wrapper
   */
  public void setContainerWrapper(ContainerWrapperBean containerWrapper) {
<span class="fc" id="L85">    this.containerWrapper = containerWrapper;</span>
<span class="fc" id="L86">  }</span>

  /**
   * Checks if is initialized.
   *
   * @return true, if is initialized
   */
  private boolean isInitialized() {
<span class="nc bnc" id="L94" title="All 4 branches missed.">    return poolNames != null &amp;&amp; !poolNames.isEmpty();</span>
  }

  /**
   * Finds ThreadPoolObjectName by its string name.
   * 
   * @param name - pool name
   * @return null if the input name is null or ThreadPoolObjectName is not found
   */
  private ThreadPoolObjectName findPool(String name) {
<span class="nc bnc" id="L104" title="All 4 branches missed.">    if (name != null &amp;&amp; isInitialized()) {</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">      for (ThreadPoolObjectName threadPoolObjectName : poolNames) {</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">        if (name.equals(threadPoolObjectName.getThreadPoolName().getKeyProperty(&quot;name&quot;))) {</span>
<span class="nc" id="L107">          return threadPoolObjectName;</span>
        }
<span class="nc" id="L109">      }</span>
    }
<span class="nc" id="L111">    return null;</span>
  }

  /**
   * Handles creation and deletion of new &quot;worker&quot; threads.
   *
   * @param notification the notification
   * @param object the object
   */
  @Override
  public synchronized void handleNotification(Notification notification, Object object) {
<span class="nc bnc" id="L122" title="All 2 branches missed.">    if (notification instanceof MBeanServerNotification</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">        &amp;&amp; MBeanServerNotification.REGISTRATION_NOTIFICATION.equals(notification.getType())</span>
<span class="nc bnc" id="L124" title="All 2 branches missed.">        || MBeanServerNotification.UNREGISTRATION_NOTIFICATION.equals(notification.getType())) {</span>

<span class="nc" id="L126">      ObjectName objectName = ((MBeanServerNotification) notification).getMBeanName();</span>
<span class="nc bnc" id="L127" title="All 2 branches missed.">      if (&quot;RequestProcessor&quot;.equals(objectName.getKeyProperty(&quot;type&quot;))) {</span>
<span class="nc" id="L128">        ThreadPoolObjectName threadPoolObjectName = findPool(objectName.getKeyProperty(&quot;worker&quot;));</span>
<span class="nc bnc" id="L129" title="All 2 branches missed.">        if (threadPoolObjectName != null) {</span>
<span class="nc bnc" id="L130" title="All 2 branches missed.">          if (MBeanServerNotification.REGISTRATION_NOTIFICATION.equals(notification.getType())) {</span>
<span class="nc" id="L131">            threadPoolObjectName.getRequestProcessorNames().add(objectName);</span>
          } else {
<span class="nc" id="L133">            threadPoolObjectName.getRequestProcessorNames().remove(objectName);</span>
          }
        }
      }
    }
<span class="nc" id="L138">  }</span>

  /**
   * Load ObjectNames for the relevant MBeans so they can be queried at a later stage without
   * searching MBean server over and over again.
   *
   * @throws Exception - this method does not handle any of the exceptions that may be thrown when
   *         querying MBean server.
   */
  private synchronized void initialize() throws Exception {

<span class="nc" id="L149">    MBeanServer server = getContainerWrapper().getResourceResolver().getMBeanServer();</span>
<span class="nc" id="L150">    String serverName = getContainerWrapper().getTomcatContainer().getName();</span>
<span class="nc" id="L151">    Set&lt;ObjectInstance&gt; threadPools =</span>
<span class="nc" id="L152">        server.queryMBeans(new ObjectName(serverName + &quot;:type=ThreadPool,name=\&quot;*\&quot;&quot;), null);</span>
<span class="nc" id="L153">    poolNames = new ArrayList&lt;&gt;(threadPools.size());</span>
<span class="nc bnc" id="L154" title="All 2 branches missed.">    for (ObjectInstance threadPool : threadPools) {</span>

<span class="nc" id="L156">      ThreadPoolObjectName threadPoolObjectName = new ThreadPoolObjectName();</span>
<span class="nc" id="L157">      ObjectName threadPoolName = threadPool.getObjectName();</span>

<span class="nc" id="L159">      String name = threadPoolName.getKeyProperty(&quot;name&quot;);</span>

<span class="nc" id="L161">      threadPoolObjectName.setThreadPoolName(threadPoolName);</span>
<span class="nc" id="L162">      ObjectName grpName = server</span>
<span class="nc" id="L163">          .getObjectInstance(new ObjectName(</span>
<span class="nc" id="L164">              threadPoolName.getDomain() + &quot;:type=GlobalRequestProcessor,name=&quot; + name))</span>
<span class="nc" id="L165">          .getObjectName();</span>
<span class="nc" id="L166">      threadPoolObjectName.setGlobalRequestProcessorName(grpName);</span>

      /*
       * unfortunately exact workers could not be found at the time of testing so we filter out the
       * relevant workers within the loop
       */
<span class="nc" id="L172">      Set&lt;ObjectInstance&gt; workers = server.queryMBeans(</span>
<span class="nc" id="L173">          new ObjectName(threadPoolName.getDomain() + &quot;:type=RequestProcessor,*&quot;), null);</span>

<span class="nc bnc" id="L175" title="All 2 branches missed.">      for (ObjectInstance worker : workers) {</span>
<span class="nc" id="L176">        ObjectName wrkName = worker.getObjectName();</span>
<span class="nc bnc" id="L177" title="All 2 branches missed.">        if (name.equals(wrkName.getKeyProperty(&quot;worker&quot;))) {</span>
<span class="nc" id="L178">          threadPoolObjectName.getRequestProcessorNames().add(wrkName);</span>
        }
<span class="nc" id="L180">      }</span>

<span class="nc" id="L182">      poolNames.add(threadPoolObjectName);</span>
<span class="nc" id="L183">    }</span>

<span class="nc" id="L185">    Set&lt;ObjectInstance&gt; executors =</span>
<span class="nc" id="L186">        server.queryMBeans(new ObjectName(serverName + &quot;:type=Executor,*&quot;), null);</span>
<span class="nc" id="L187">    executorNames = new ArrayList&lt;&gt;(executors.size());</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">    for (ObjectInstance executor : executors) {</span>
<span class="nc" id="L189">      ObjectName executorName = executor.getObjectName();</span>
<span class="nc" id="L190">      executorNames.add(executorName);</span>
<span class="nc" id="L191">    }</span>

    // Register with MBean server
<span class="nc" id="L194">    server.addNotificationListener(new ObjectName(&quot;JMImplementation:type=MBeanServerDelegate&quot;),</span>
        this, null, null);

<span class="nc" id="L197">  }</span>

  /**
   * Gets the thread pools.
   *
   * @return the thread pools
   * @throws Exception the exception
   */
  public synchronized List&lt;ThreadPool&gt; getThreadPools() throws Exception {
<span class="nc bnc" id="L206" title="All 2 branches missed.">    if (!isInitialized()) {</span>
<span class="nc" id="L207">      initialize();</span>
    }

<span class="nc" id="L210">    List&lt;ThreadPool&gt; threadPools = new ArrayList&lt;&gt;(poolNames.size());</span>

<span class="nc" id="L212">    MBeanServer server = getContainerWrapper().getResourceResolver().getMBeanServer();</span>

<span class="nc bnc" id="L214" title="All 2 branches missed.">    for (ObjectName executorName : executorNames) {</span>
<span class="nc" id="L215">      ThreadPool threadPool = new ThreadPool();</span>
<span class="nc" id="L216">      threadPool.setName(executorName.getKeyProperty(&quot;name&quot;));</span>
<span class="nc" id="L217">      threadPool.setMaxThreads(JmxTools.getIntAttr(server, executorName, &quot;maxThreads&quot;));</span>
<span class="nc" id="L218">      threadPool.setMaxSpareThreads(JmxTools.getIntAttr(server, executorName, &quot;largestPoolSize&quot;));</span>
<span class="nc" id="L219">      threadPool.setMinSpareThreads(JmxTools.getIntAttr(server, executorName, &quot;minSpareThreads&quot;));</span>
<span class="nc" id="L220">      threadPool.setCurrentThreadsBusy(JmxTools.getIntAttr(server, executorName, &quot;activeCount&quot;));</span>
<span class="nc" id="L221">      threadPool.setCurrentThreadCount(JmxTools.getIntAttr(server, executorName, &quot;poolSize&quot;));</span>
<span class="nc" id="L222">      threadPools.add(threadPool);</span>
<span class="nc" id="L223">    }</span>

<span class="nc bnc" id="L225" title="All 2 branches missed.">    for (ThreadPoolObjectName threadPoolObjectName : poolNames) {</span>
      try {
<span class="nc" id="L227">        ObjectName poolName = threadPoolObjectName.getThreadPoolName();</span>

<span class="nc" id="L229">        ThreadPool threadPool = new ThreadPool();</span>
<span class="nc" id="L230">        threadPool.setName(poolName.getKeyProperty(&quot;name&quot;));</span>
<span class="nc" id="L231">        threadPool.setMaxThreads(JmxTools.getIntAttr(server, poolName, &quot;maxThreads&quot;));</span>

<span class="nc bnc" id="L233" title="All 2 branches missed.">        if (JmxTools.hasAttribute(server, poolName, &quot;maxSpareThreads&quot;)) {</span>
<span class="nc" id="L234">          threadPool.setMaxSpareThreads(JmxTools.getIntAttr(server, poolName, &quot;maxSpareThreads&quot;));</span>
<span class="nc" id="L235">          threadPool.setMinSpareThreads(JmxTools.getIntAttr(server, poolName, &quot;minSpareThreads&quot;));</span>
        }

<span class="nc" id="L238">        threadPool</span>
<span class="nc" id="L239">            .setCurrentThreadsBusy(JmxTools.getIntAttr(server, poolName, &quot;currentThreadsBusy&quot;));</span>
<span class="nc" id="L240">        threadPool</span>
<span class="nc" id="L241">            .setCurrentThreadCount(JmxTools.getIntAttr(server, poolName, &quot;currentThreadCount&quot;));</span>

        /*
         * Tomcat will return -1 for maxThreads if the connector uses an executor for its threads.
         * In this case, don't add its ThreadPool to the results.
         */
<span class="nc bnc" id="L247" title="All 2 branches missed.">        if (threadPool.getMaxThreads() &gt; -1) {</span>
<span class="nc" id="L248">          threadPools.add(threadPool);</span>
        }
<span class="nc" id="L250">      } catch (InstanceNotFoundException e) {</span>
<span class="nc" id="L251">        logger.error(&quot;Failed to query entire thread pool {}&quot;, threadPoolObjectName);</span>
<span class="nc" id="L252">        logger.debug(&quot;&quot;, e);</span>
<span class="nc" id="L253">      }</span>
<span class="nc" id="L254">    }</span>
<span class="nc" id="L255">    return threadPools;</span>
  }

  /**
   * Toggle connector status.
   *
   * @param operation the operation
   * @param port the port
   * @throws Exception the exception
   */
  public synchronized void toggleConnectorStatus(String operation, String port) throws Exception {

<span class="nc bnc" id="L267" title="All 2 branches missed.">    if (!allowedOperation.contains(operation)) {</span>
<span class="nc" id="L268">      logger.error(&quot;operation {} not supported&quot;, operation);</span>
<span class="nc" id="L269">      throw new IllegalArgumentException(&quot;Not support operation&quot;);</span>
    }

<span class="nc" id="L272">    ObjectName objectName = new ObjectName(&quot;Catalina:type=Connector,port=&quot; + port);</span>

<span class="nc" id="L274">    MBeanServer server = getContainerWrapper().getResourceResolver().getMBeanServer();</span>

<span class="nc" id="L276">    JmxTools.invoke(server, objectName, operation, null, null);</span>

<span class="nc" id="L278">    logger.info(&quot;operation {} on Connector {} invoked success&quot;, operation, objectName);</span>
<span class="nc" id="L279">  }</span>

  /**
   * Gets the connectors.
   *
   * @param includeRequestProcessors the include request processors
   * @return the connectors
   * @throws Exception the exception
   */
  public synchronized List&lt;Connector&gt; getConnectors(boolean includeRequestProcessors)
      throws Exception {

<span class="nc" id="L291">    boolean workerThreadNameSupported = true;</span>

<span class="nc bnc" id="L293" title="All 2 branches missed.">    if (!isInitialized()) {</span>
<span class="nc" id="L294">      initialize();</span>
    }

<span class="nc" id="L297">    List&lt;Connector&gt; connectors = new ArrayList&lt;&gt;(poolNames.size());</span>

<span class="nc" id="L299">    MBeanServer server = getContainerWrapper().getResourceResolver().getMBeanServer();</span>

<span class="nc bnc" id="L301" title="All 2 branches missed.">    for (ThreadPoolObjectName threadPoolObjectName : poolNames) {</span>
      try {
<span class="nc" id="L303">        ObjectName poolName = threadPoolObjectName.getThreadPoolName();</span>

<span class="nc" id="L305">        Connector connector = new Connector();</span>

<span class="nc" id="L307">        String name = poolName.getKeyProperty(&quot;name&quot;);</span>

<span class="nc" id="L309">        connector.setProtocolHandler(poolName.getKeyProperty(&quot;name&quot;));</span>

<span class="nc bnc" id="L311" title="All 4 branches missed.">        if (name.startsWith(&quot;\&quot;&quot;) &amp;&amp; name.endsWith(&quot;\&quot;&quot;)) {</span>
<span class="nc" id="L312">          name = name.substring(1, name.length() - 1);</span>
        }

<span class="nc" id="L315">        String[] arr = name.split(&quot;-&quot;);</span>
<span class="nc" id="L316">        String port = &quot;-1&quot;;</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">        if (arr.length == 3) {</span>
<span class="nc" id="L318">          port = arr[2];</span>
        }

<span class="nc bnc" id="L321" title="All 2 branches missed.">        if (!&quot;-1&quot;.equals(port)) {</span>
<span class="nc" id="L322">          String str = &quot;Catalina:type=Connector,port=&quot; + port;</span>

<span class="nc" id="L324">          ObjectName objectName = new ObjectName(str);</span>

          // add some useful information for connector list
<span class="nc" id="L327">          connector.setStatus(JmxTools.getStringAttr(server, objectName, &quot;stateName&quot;));</span>
<span class="nc" id="L328">          connector.setProtocol(JmxTools.getStringAttr(server, objectName, &quot;protocol&quot;));</span>
<span class="nc" id="L329">          connector.setSecure(</span>
<span class="nc" id="L330">              Boolean.parseBoolean(JmxTools.getStringAttr(server, objectName, &quot;secure&quot;)));</span>
<span class="nc" id="L331">          connector.setPort(JmxTools.getIntAttr(server, objectName, &quot;port&quot;));</span>
<span class="nc" id="L332">          connector.setLocalPort(JmxTools.getIntAttr(server, objectName, &quot;localPort&quot;));</span>
<span class="nc" id="L333">          connector.setSchema(JmxTools.getStringAttr(server, objectName, &quot;schema&quot;));</span>
        }

<span class="nc" id="L336">        ObjectName grpName = threadPoolObjectName.getGlobalRequestProcessorName();</span>

<span class="nc" id="L338">        connector.setMaxTime(JmxTools.getLongAttr(server, grpName, &quot;maxTime&quot;));</span>
<span class="nc" id="L339">        connector.setProcessingTime(JmxTools.getLongAttr(server, grpName, &quot;processingTime&quot;));</span>
<span class="nc" id="L340">        connector.setBytesReceived(JmxTools.getLongAttr(server, grpName, &quot;bytesReceived&quot;));</span>
<span class="nc" id="L341">        connector.setBytesSent(JmxTools.getLongAttr(server, grpName, &quot;bytesSent&quot;));</span>
<span class="nc" id="L342">        connector.setRequestCount(JmxTools.getIntAttr(server, grpName, &quot;requestCount&quot;));</span>
<span class="nc" id="L343">        connector.setErrorCount(JmxTools.getIntAttr(server, grpName, &quot;errorCount&quot;));</span>

<span class="nc bnc" id="L345" title="All 2 branches missed.">        if (includeRequestProcessors) {</span>
<span class="nc" id="L346">          List&lt;ObjectName&gt; wrkNames = threadPoolObjectName.getRequestProcessorNames();</span>
<span class="nc bnc" id="L347" title="All 2 branches missed.">          for (ObjectName wrkName : wrkNames) {</span>
            try {
<span class="nc" id="L349">              RequestProcessor rp = new RequestProcessor();</span>
<span class="nc" id="L350">              rp.setName(wrkName.getKeyProperty(&quot;name&quot;));</span>
<span class="nc" id="L351">              rp.setStage(JmxTools.getIntAttr(server, wrkName, &quot;stage&quot;));</span>
<span class="nc" id="L352">              rp.setProcessingTime(JmxTools.getLongAttr(server, wrkName, &quot;requestProcessingTime&quot;));</span>
<span class="nc" id="L353">              rp.setBytesSent(JmxTools.getLongAttr(server, wrkName, &quot;requestBytesSent&quot;));</span>
<span class="nc" id="L354">              rp.setBytesReceived(JmxTools.getLongAttr(server, wrkName, &quot;requestBytesReceived&quot;));</span>
              try {
<span class="nc" id="L356">                rp.setRemoteAddr(JmxTools.getStringAttr(server, wrkName, &quot;remoteAddr&quot;));</span>
<span class="nc" id="L357">              } catch (RuntimeOperationsException ex) {</span>
<span class="nc" id="L358">                logger.trace(&quot;&quot;, ex);</span>
<span class="nc" id="L359">              }</span>

<span class="nc bnc" id="L361" title="All 2 branches missed.">              if (rp.getRemoteAddr() != null) {</span>
                // Show flag as defined in jvm for localhost
<span class="nc bnc" id="L363" title="All 2 branches missed.">                if (InetAddress.getByName(rp.getRemoteAddr()).isLoopbackAddress()) {</span>
<span class="nc" id="L364">                  rp.setRemoteAddrLocale(new Locale(System.getProperty(&quot;user.language&quot;),</span>
<span class="nc" id="L365">                      System.getProperty(&quot;user.country&quot;)));</span>
                } else {
                  // Show flag for non-localhost using geo lite
<span class="nc" id="L368">                  try (DatabaseReader reader = new DatabaseReader.Builder(new File(</span>
<span class="nc" id="L369">                      getClass().getClassLoader().getResource(&quot;GeoLite2-Country.mmdb&quot;).toURI()))</span>
<span class="nc" id="L370">                          .withCache(new CHMCache()).build()) {</span>
<span class="nc" id="L371">                    CountryResponse response =</span>
<span class="nc" id="L372">                        reader.country(InetAddress.getByName(rp.getRemoteAddr()));</span>
<span class="nc" id="L373">                    Country country = response.getCountry();</span>
<span class="nc" id="L374">                    rp.setRemoteAddrLocale(new Locale(&quot;&quot;, country.getIsoCode()));</span>
<span class="nc" id="L375">                  } catch (AddressNotFoundException e) {</span>
<span class="nc" id="L376">                    logger.debug(&quot;Address Not Found: {}&quot;, e.getMessage());</span>
<span class="nc" id="L377">                    logger.trace(&quot;&quot;, e);</span>
<span class="nc" id="L378">                  }</span>
                }
              }

<span class="nc" id="L382">              rp.setVirtualHost(JmxTools.getStringAttr(server, wrkName, &quot;virtualHost&quot;));</span>
<span class="nc" id="L383">              rp.setMethod(JmxTools.getStringAttr(server, wrkName, &quot;method&quot;));</span>
<span class="nc" id="L384">              rp.setCurrentUri(JmxTools.getStringAttr(server, wrkName, &quot;currentUri&quot;));</span>
<span class="nc" id="L385">              rp.setCurrentQueryString(</span>
<span class="nc" id="L386">                  JmxTools.getStringAttr(server, wrkName, &quot;currentQueryString&quot;));</span>
<span class="nc" id="L387">              rp.setProtocol(JmxTools.getStringAttr(server, wrkName, &quot;protocol&quot;));</span>

              // Relies on https://issues.apache.org/bugzilla/show_bug.cgi?id=41128
<span class="nc bnc" id="L390" title="All 2 branches missed.">              if (workerThreadNameSupported</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">                  &amp;&amp; JmxTools.hasAttribute(server, wrkName, &quot;workerThreadName&quot;)) {</span>

<span class="nc" id="L393">                rp.setWorkerThreadName(JmxTools.getStringAttr(server, wrkName, &quot;workerThreadName&quot;));</span>
<span class="nc" id="L394">                rp.setWorkerThreadNameSupported(true);</span>
              } else {
                /*
                 * attribute should consistently either exist or be missing across all the workers
                 * so it does not make sense to check attribute existence if we have found once that
                 * it is not supported
                 */
<span class="nc" id="L401">                rp.setWorkerThreadNameSupported(false);</span>
<span class="nc" id="L402">                workerThreadNameSupported = false;</span>
              }
<span class="nc" id="L404">              connector.addRequestProcessor(rp);</span>
<span class="nc" id="L405">            } catch (InstanceNotFoundException e) {</span>
<span class="nc" id="L406">              logger.info(&quot;Failed to query RequestProcessor {}&quot;, wrkName);</span>
<span class="nc" id="L407">              logger.debug(&quot;&quot;, e);</span>
<span class="nc" id="L408">            }</span>
<span class="nc" id="L409">          }</span>
        }

<span class="nc" id="L412">        connectors.add(connector);</span>
<span class="nc" id="L413">      } catch (InstanceNotFoundException e) {</span>
<span class="nc" id="L414">        logger.error(&quot;Failed to query entire thread pool {}&quot;, threadPoolObjectName);</span>
<span class="nc" id="L415">        logger.debug(&quot;  Stack trace:&quot;, e);</span>
<span class="nc" id="L416">      }</span>
<span class="nc" id="L417">    }</span>
<span class="nc" id="L418">    return connectors;</span>
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>