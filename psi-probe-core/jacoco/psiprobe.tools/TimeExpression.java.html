<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TimeExpression.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">psi-probe-core</a> &gt; <a href="index.source.html" class="el_package">psiprobe.tools</a> &gt; <span class="el_source">TimeExpression.java</span></div><h1>TimeExpression.java</h1><pre class="source lang-java linenums">/**
 * Licensed under the GPL License. You may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   https://www.gnu.org/licenses/old-licenses/gpl-2.0.html
 *
 * THIS PACKAGE IS PROVIDED &quot;AS IS&quot; AND WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
 * WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE.
 */
package psiprobe.tools;

/**
 * The Class TimeExpression.
 */
public final class TimeExpression {

  /**
   * Prevent Instantiation.
   */
  private TimeExpression() {
    // Prevent Instantiation
  }

  /**
   * Data points.
   *
   * @param periodExpression the period expression
   * @param spanExpression the span expression
   * @return the long
   */
  public static long dataPoints(String periodExpression, String spanExpression) {
<span class="nc" id="L33">    return dataPoints(inSeconds(periodExpression), inSeconds(spanExpression));</span>
  }

  /**
   * Data points.
   *
   * @param period the period
   * @param span the span
   * @return the long
   */
  public static long dataPoints(long period, long span) {
<span class="nc bnc" id="L44" title="All 2 branches missed.">    if (period &lt;= 0) {</span>
<span class="nc" id="L45">      return 0;</span>
    }
<span class="nc" id="L47">    return span / period;</span>
  }

  /**
   * Cron expression.
   *
   * @param periodExpression the period expression
   * @param phaseExpression the phase expression
   * @return the string
   */
  public static String cronExpression(String periodExpression, String phaseExpression) {
<span class="fc" id="L58">    return cronExpression(inSeconds(periodExpression), inSeconds(phaseExpression));</span>
  }

  /**
   * Cron expression.
   *
   * @param period the period
   * @param phase the phase
   * @return the string
   */
  public static String cronExpression(long period, long phase) {
<span class="pc bpc" id="L69" title="1 of 2 branches missed.">    while (phase &gt;= period) {</span>
<span class="nc" id="L70">      phase = phase - period;</span>
    }
<span class="fc" id="L72">    long secondsPeriod = 0;</span>
<span class="fc" id="L73">    long minutesPeriod = 0;</span>
<span class="fc" id="L74">    long hoursPeriod = 0;</span>
<span class="fc bfc" id="L75" title="All 2 branches covered.">    if (period &lt; 60) {</span>
<span class="fc" id="L76">      secondsPeriod = period;</span>
<span class="pc bpc" id="L77" title="1 of 2 branches missed.">    } else if (period &lt; 60 * 60) {</span>
<span class="fc" id="L78">      minutesPeriod = period / 60;</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">    } else if (period &lt; 60 * 60 * 24) {</span>
<span class="nc" id="L80">      hoursPeriod = period / (60 * 60);</span>
    } else {
<span class="nc" id="L82">      throw new IllegalArgumentException(&quot;Period is too large: &quot; + period);</span>
    }
<span class="fc" id="L84">    long secondsPhase = 0;</span>
<span class="fc" id="L85">    long minutesPhase = 0;</span>
<span class="fc" id="L86">    long hoursPhase = 0;</span>
<span class="pc bpc" id="L87" title="1 of 2 branches missed.">    if (phase &lt; 60) {</span>
<span class="fc" id="L88">      secondsPhase = phase;</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">    } else if (phase &lt; 60 * 60) {</span>
<span class="nc" id="L90">      minutesPhase = phase / 60;</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">    } else if (phase &lt; 60 * 60 * 24) {</span>
<span class="nc" id="L92">      hoursPhase = phase / (60 * 60);</span>
    } else {
<span class="nc" id="L94">      throw new IllegalArgumentException(&quot;Phase is too large: &quot; + phase);</span>
    }
<span class="fc" id="L96">    String secondsCron = cronSubexpression(secondsPeriod, secondsPhase);</span>
<span class="fc" id="L97">    String minutesCron = &quot;*&quot;;</span>
<span class="fc" id="L98">    String hoursCron = &quot;*&quot;;</span>
<span class="fc" id="L99">    String daysCron = &quot;*&quot;;</span>
<span class="fc" id="L100">    String monthsCron = &quot;*&quot;;</span>
<span class="fc" id="L101">    String dowCron = &quot;?&quot;;</span>
<span class="fc bfc" id="L102" title="All 2 branches covered.">    if (secondsPeriod == 0) {</span>
<span class="fc" id="L103">      minutesCron = cronSubexpression(minutesPeriod, minutesPhase);</span>
<span class="pc bpc" id="L104" title="1 of 2 branches missed.">      if (minutesPeriod == 0) {</span>
<span class="nc" id="L105">        hoursCron = cronSubexpression(hoursPeriod, hoursPhase);</span>
      }
    }
<span class="fc" id="L108">    return secondsCron + &quot; &quot; + minutesCron + &quot; &quot; + hoursCron + &quot; &quot; + daysCron + &quot; &quot; + monthsCron</span>
        + &quot; &quot; + dowCron;
  }

  /**
   * Cron subexpression.
   *
   * @param period the period
   * @param phase the phase
   * @return the string
   */
  private static String cronSubexpression(long period, long phase) {
<span class="fc bfc" id="L120" title="All 2 branches covered.">    if (period == 0) {</span>
<span class="fc" id="L121">      return Long.toString(phase);</span>
<span class="pc bpc" id="L122" title="3 of 4 branches missed.">    } else if (period == 1 &amp;&amp; phase == 0) {</span>
<span class="nc" id="L123">      return &quot;*&quot;;</span>
    } else {
<span class="fc" id="L125">      return phase + &quot;/&quot; + period;</span>
    }
  }

  /**
   * In seconds.
   *
   * @param expression the expression
   * @return the long
   */
  public static long inSeconds(String expression) {
<span class="pc bpc" id="L136" title="2 of 4 branches missed.">    if (expression == null || expression.isEmpty()) {</span>
<span class="nc" id="L137">      return 0;</span>
    }
<span class="pc bpc" id="L139" title="1 of 2 branches missed.">    if (expression.matches(&quot;[0-9]+[smhd]&quot;)) {</span>
<span class="fc" id="L140">      long multiplier = multiplier(expression.charAt(expression.length() - 1));</span>
<span class="pc bpc" id="L141" title="1 of 2 branches missed.">      if (multiplier == 0) {</span>
<span class="nc" id="L142">        throw new IllegalArgumentException(&quot;Invalid unit in expression: &quot; + expression);</span>
      }
<span class="fc" id="L144">      long value = Integer.parseInt(expression.substring(0, expression.length() - 1));</span>
<span class="pc bpc" id="L145" title="1 of 2 branches missed.">      if (value &lt; 0) {</span>
<span class="nc" id="L146">        throw new IllegalArgumentException(&quot;Invalid value in expression: &quot; + expression);</span>
      }
<span class="fc" id="L148">      return value * multiplier;</span>
    }
<span class="nc" id="L150">    throw new IllegalArgumentException(&quot;Invalid expression format: &quot; + expression);</span>
  }

  /**
   * Multiplier.
   *
   * @param unit the unit
   * @return the int
   */
  private static int multiplier(char unit) {
<span class="pc bpc" id="L160" title="2 of 4 branches missed.">    switch (unit) {</span>
      case 's':
<span class="fc" id="L162">        return 1;</span>
      case 'm':
<span class="fc" id="L164">        return 60;</span>
      case 'h':
<span class="nc" id="L166">        return 60 * 60;</span>
      default:
<span class="nc" id="L168">        throw new IllegalArgumentException(&quot;Invalid unit: &quot; + unit);</span>
    }
  }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>